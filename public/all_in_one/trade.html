<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade | BoostInvest</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" type="image/png" href="./images/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>

          .btn-secondary-id {
            background: var(--accent-color);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            margin-right: 10px;
            border: 1px solid var(--white);
        }

        .btn-signout {
            background: #ef4444;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            border: 1px solid #b91c1c;
        }

.box {
  border: 2px dashed #222;
  padding: 15px;
  margin: 20px;
  border-radius: 8px;
}

.setup {
  background: var(--primary-color);
  text-align: center;
}

.setup h3 {
  margin: 0 0 10px;
  color: var(--accent-color);
}

.time {
  color: #555;
  font-size: 14px;
}

select, button {
  width: 100%;
  padding: 10px;
  margin-bottom: 12px;
  font-size: 16px;
}

button {
  cursor: pointer;
}

.disabled {
  opacity: 0.9;
  pointer-events: none;
  background: var(--accent-color);
  color: #ffffff;
}

#status {
  font-weight: bold;
  text-align: center;
  margin-top: 10px;
}

        footer{
        margin-top: 40px;
        background: #f1f5f9;
        }

        .main-footer p{
        text-align: center;
        margin: 0;
        padding: 3px 0;     
        color: #475569;
        font-size: 0.9rem;
        }
</style>
</head>

<body>

   
    <header class="main-header">
        <div class="container user-header-content">
            
                    <!-- Hamburger Button -->
        <button class="hamburger" aria-label="Toggle Menu">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </button>

        <!-- Mobile Menu -->
        <nav class="mobile-nav">
            <div class="logo-name">
            <img src="./images/logo.png" alt="main-logo" width="35px">
            <h1 class="logo">BoostInvest</h1>
            </div>
        
        

            <div style="margin: 20px;" class="auth-buttons">
                <a href="#" class="btn btn-secondary-id" id="copy-id-btn">
                    ID: <span id="user-id-display">...</span>
                </a>
                <a href="#" class="btn btn-signout" id="logout-btn">Log Out</a>
            </div>
            </nav>
        </div>
    </header>

<!-- üîù SYSTEM SETUP BOX -->
<div class="box setup">
  <h3>üìå DAILY TRADE SETUP</h3>
  <div id="dailySetup">Loading...</div>
  <div class="time">
    ‚è∞ Trade Time: <b>14:00 ‚Äì 14:10 (UTC+3)</b><br>
    üïí Result Time: <b>14:15</b>
  </div>
</div>

<!-- üë§ USER TRADE -->
<div class="box">
  <label>Crypto Pair</label>
  <select id="pair">
    <option>BTC/USDT</option>
    <option>ETH/USDT</option>
    <option>BNB/USDT</option>
    <option>SOL/USDT</option>
    <option>XRP/USDT</option>
  </select>

  <label>Timeframe</label>
  <select id="timeframe">
    <option>1MIN</option>
    <option>5MIN</option>
    <option>15MIN</option>
  </select>

  <label>Trade Type</label>
  <select id="type">
    <option>BUY</option>
    <option>SELL</option>
  </select>

  <button id="tradeBtn">Trade</button>

  <div id="status"></div>


</div>

  <footer class="main-footer">
            <p>&copy; 2024 BoostInvest. All rights reserved.</p>
  </footer>
  
    <nav class="mobile-bottom-nav">
        <div class="nav-item"><a href="./user-dashbourd.html" class="active"><i class="fas fa-home"></i><span>Home</span></a></div>
        <div class="nav-item"><a href="./trade.html"><i class="fas fa-chart-line"></i><span>Trade</span></a></div> 
        <div class="nav-item"><a href="./teams.html"><i class="fas fa-users"></i><span>Teams</span></a></div>
        <div class="nav-item"><a href="./account.html"><i class="fas fa-user-circle"></i><span>Account</span></a></div>
    </nav>

<script type="module">
    import { supabase } from './supabase.js';

    const dailySetup = document.getElementById("dailySetup");
    const tradeBtn = document.getElementById("tradeBtn");
    const statusDiv = document.getElementById("status");
    const pairSelect = document.getElementById("pair");
    const timeframeSelect = document.getElementById("timeframe");
    const typeSelect = document.getElementById("type");

    const TRADE_START = 14 * 60;      // 14:00
    const TRADE_END = 14 * 60 + 10;   // 14:10

    // 1. Soo qaado xogta maanta ee database-ka
    async function fetchTodaySetup() {
        const today = new Date().toISOString().split("T")[0];
        const { data, error } = await supabase
            .from("daily_trade")
            .select("*")
            .eq("trade_date", today)
            .single();

        if (data) {
            dailySetup.innerText = `${data.pair} ‚Ä¢ ${data.timeframe} ‚Ä¢ ${data.trade_type}`;
        } else {
            dailySetup.innerText = "No setup for today yet.";
        }
    }

    function nowMinutesUTC3() {
        const now = new Date();
        const utc = now.getTime() + now.getTimezoneOffset() * 60000;
        const utc3 = new Date(utc + 3 * 60 * 60000);
        return utc3.getHours() * 60 + utc3.getMinutes();
    }

    function tradeOpen() {
        const m = nowMinutesUTC3();
        return m >= TRADE_START && m <= TRADE_END;
    }

    function updateButton() {
        if (tradeOpen()) {
            tradeBtn.classList.remove("disabled");
            tradeBtn.innerText = "Trade Now";
        } else {
            tradeBtn.classList.add("disabled");
            tradeBtn.innerText = "Trade Closed";
        }
    }

    // Bilow shaqada
    fetchTodaySetup();
    updateButton();
    setInterval(updateButton, 10000); // Hubi waqtiga 10-kii ilbiriqsiba

    tradeBtn.addEventListener("click", async () => {
        if (!tradeOpen()) {
            alert("Trade waqtigiisu ma furan");
            return;
        }

        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
            alert("Fadlan login sameey");
            return;
        }

        const today = new Date().toISOString().split("T")[0];
        const userChoice = `${pairSelect.value} ${timeframeSelect.value} ${typeSelect.value}`;

        // Hubi haduu mar hore trade-gareeyay
        const { data: exists } = await supabase
            .from("trade_history")
            .select("id")
            .eq("user_id", user.id)
            .eq("trade_date", today);

        if (exists && exists.length > 0) {
            statusDiv.innerText = "‚ùå Maanta mar hore ayaad trade-garaysay!";
            return;
        }

        // Geli trade-ka cusub
        const { error } = await supabase.from("trade_history").insert({
            user_id: user.id,
            user_choice: userChoice,
            trade_date: today,
            status: "PENDING"
        });

        if (!error) {
            statusDiv.innerText = "‚úÖ Trade-kaaga waa la gudbiyey!";
            tradeBtn.classList.add("disabled");
        } else {
            statusDiv.innerText = "‚ùå Cilad ayaa dhacday.";
        }
    });
     


       // 3. Copy ID Function
            function setupCopy(code) {
                const btn = document.getElementById('copy-id-btn');
                btn.onclick = (e) => {
                    e.preventDefault();
                    navigator.clipboard.writeText(code);
                    const old = btn.innerHTML;
                    btn.innerHTML = "Copied! ‚úÖ";
                    setTimeout(() => btn.innerHTML = old, 2000);
                };
            }

              // 4. Log Out with Spinner
            const logoutBtn = document.getElementById('logout-btn');
            logoutBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                if (confirm("Ma hubtaa inaad baxayso?")) {
                    logoutBtn.classList.add('loading');
                    logoutBtn.innerHTML = `<span class="spinner"></span> Safar nabad ah...`;

                    const { error } = await supabase.auth.signOut();
                    if (!error) {
                        localStorage.clear();
                        window.location.href = './signin.html';
                    } else {
                        alert("Error: " + error.message);
                        logoutBtn.classList.remove('loading');
                        logoutBtn.innerHTML = "Log Out";
                    }
                }
            });
    
</script>

    <script>// script.js
const hamburger = document.querySelector(".hamburger");
const mobileNav = document.querySelector(".mobile-nav");

hamburger.addEventListener("click", () => {
    mobileNav.classList.toggle("active");
});

</script>


</body>
</html>
